# 代码评估工具

本目录包含用于评估QwenRag项目代码质量的工具脚本。

## 📋 脚本说明

### 1. code_eval.py - 完整代码评估

**功能:**
- 详细的代码行数统计（源码、测试、文档）
- 测试覆盖率分析
- 代码复杂度评估
- 质量指标计算
- 改进建议生成

**使用方法:**
```bash
python3 eval/code_eval.py
```

**输出:**
- 控制台显示详细报告
- 生成 `code_evaluation_report.json` 详细数据文件

### 2. quick_stats.py - 快速统计

**功能:**
- 基本代码行数统计
- 测试覆盖率检查
- 项目规模评估

**使用方法:**
```bash
python3 eval/quick_stats.py
```

**输出:**
- 控制台显示简洁统计信息

## 📊 评估指标

### 代码统计
- **源代码行数**: 实际功能代码行数
- **测试代码行数**: 测试用例代码行数
- **注释行数**: 文档和注释行数
- **空白行数**: 空行数量

### 质量指标
- **测试覆盖率**: 代码被测试覆盖的百分比
- **测试/代码比**: 测试代码与源代码的比例
- **函数数量**: 项目中函数总数
- **类数量**: 项目中类总数
- **平均函数长度**: 函数平均行数

### 复杂度分析
- **高复杂度文件**: 超过500行的文件
- **函数长度分布**: 函数长度统计

## 📈 质量标准

### 优秀指标
- 测试覆盖率 > 80%
- 测试/代码比 > 0.5
- 平均函数长度 < 50行
- 无高复杂度文件

### 良好指标
- 测试覆盖率 > 60%
- 测试/代码比 > 0.3
- 平均函数长度 < 100行

## 🚀 使用建议

### 开发流程中使用
1. **功能开发前**: 运行 `quick_stats.py` 了解当前状态
2. **功能开发后**: 运行 `code_eval.py` 检查覆盖率变化
3. **发布前**: 确保所有质量指标达标

### 持续改进
1. 定期运行完整评估
2. 针对低覆盖率文件编写测试
3. 重构高复杂度文件
4. 保持良好的测试/代码比

## 📁 生成文件

- `code_evaluation_report.json`: 详细的JSON格式评估报告
- `coverage.json`: pytest-cov生成的覆盖率数据
- `.coverage`: coverage工具的数据文件

## ⚙️ 依赖要求

```bash
pip install coverage pytest pytest-cov
```

## 🔧 自定义配置

可以通过修改脚本中的配置来调整评估参数:

```python
# code_eval.py 中的配置
self.source_dirs = ['processors', 'vector_store', 'schemas', 'utils']
self.test_dirs = ['tests']
self.exclude_dirs = {'.git', '__pycache__', '.pytest_cache'}
```

## 📝 报告示例

```
📊 QwenRag 项目代码评估报告
================================================================================

📁 项目概览:
   源代码文件: 14
   测试文件: 5
   文档文件: 4
   总文件数: 23

📝 代码统计:
   源代码:
     总行数: 2,505
     代码行: 1,684
     注释行: 283
     空白行: 538
   测试代码:
     总行数: 809
     代码行: 489
     注释行: 140
     空白行: 180

📈 质量指标:
   测试覆盖率: 53.3%
   测试/代码比: 0.29
   函数总数: 13
   类总数: 11
   平均函数长度: 31.6 行

💡 改进建议:
   • 提高测试覆盖率到80%以上 (当前: 53.3%)
   • 增加测试代码，建议测试/代码比达到0.5以上 (当前: 0.29)
```

## 🎯 下一步改进

根据当前评估结果，建议：

1. **提高测试覆盖率**
   - 为 `demo.py`, `main_index.py`, `main_search.py` 添加测试
   - 完善现有模块的边界测试

2. **增加测试代码**
   - 目标：测试/代码比达到 0.5+
   - 重点：核心业务逻辑的测试

3. **优化代码结构**
   - 重构过长的函数
   - 提高代码可读性